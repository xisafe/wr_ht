<style>
    .nav-tabs > li.active > a {
        color: #fff;
        background-color: #58AAFC;
        border: #777 solid 1px;
    }

    .nav-tabs > li.active > a:hover {
        color: #fff;
        background-color: #58AAFC;
        border: #777 solid 1px;
    }

    .nav-tabs > li.active > a:focus {
        color: #fff;
        background-color: #58AAFC;
        border: #777 solid 1px;
    }

    .nav-tabs > li > a {
        color: #333;
        background: #fff;
        border: #777 solid 1px;
        margin: 0 0 0 -1px;
        border-radius: 0px;
    }

    .nav-tabs > li > a:hover {
        color: #333;
        background: #fff;
        border: #777 solid 1px;
    }

    #myTab {
        padding-left: 30%;
        border-bottom: none;
    }

    label.col-sm-2 {
        width: 10%;
    }

    label.col-sm-3 {
        width: 19.5%;
    }

    .form-group {
        margin-bottom: 30px;
    }

</style>


<div class="panel" style="margin-bottom: 10px; overflow: hidden; padding: 10px 0;">
    <strong class="pull-left" style="line-height: 40px; padding-left: 10px;">编辑大额H5合作产品</strong>
    <ul id="myTab" class="nav nav-tabs pull-left">
        <li class="active"><a class="tab1" href="#tab1" data-toggle="tab">机构信息</a></li>
        <li><a class="tab2" href="#tab2" data-toggle="tab">产品信息</a></li>
        <li><a class="tab3" href="#tab3" data-toggle="tab">结算信息</a></li>
        <li><a class="tab4" href="#tab4" data-toggle="tab">链接信息</a></li>
    </ul>
</div>

<div id="myTabContent" class="tab-content">
    <div class="tab-pane active" id="tab1">
        <form class="form-horizontal">
            <div class="panel" style="margin-bottom: 0px;">
                <div class="panel-heading">机构信息</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="jigouName" class="col-sm-2 control-label">机构名称<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="jigouName" placeholder="请输入机构名称" value="{{.org.Name}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contactAddr" class="col-sm-2 control-label">通讯录地址</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="contactAddr" placeholder="请输入通讯录地址" value="{{.org.Address}}">   
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contactMail" class="col-sm-2 control-label">联系邮箱</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="contactMail" placeholder="请输入邮箱地址" value="{{.org.Email}}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">商务联系人</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="contactName" class="col-sm-2 control-label">联系人姓名</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="contactName" placeholder="请输入联系人姓名" value="{{.bus.Name}}">
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    <div class="left" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="contactPhone" class="col-sm-3 control-label">手机号码</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="contactPhone" placeholder="请输入联系人手机号码" value="{{.bus.Phone}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="QQCode" class="col-sm-3 control-label">QQ</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="QQCode" placeholder="请输入联系人QQ" value="{{.bus.Qq}}">
                            </div>
                        </div>
                    </div>
                    <div class="right" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="weixinCode" class="col-sm-3 control-label">微信</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="weixinCode" placeholder="请输入联系人微信" value="{{.bus.Wechat}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="eMail" class="col-sm-3 control-label">邮箱</label>
                            <div class="col-sm-6">
                                <input type="eMail" class="form-control" id="email" placeholder="请输入联系人邮箱" value="{{.bus.Email}}">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-info jigouDtlSave" id="jigouDtlSave" style="margin: 0 auto; display: block; width: 120px;">保存</button>
                </div>
            </div>
        </form>
    </div>

    <div class="tab-pane" id="tab2">
        <div class="form-horizontal">
            <div class="panel"  style="margin-bottom: 0px;">
                <div class="panel-heading">产品信息</div>
                <input type="hidden" id="productId" value="{{.product.Id}}"/>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="proName" class="col-sm-2 control-label">产品名称<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="proName" placeholder="请输入产品名称" value="{{.product.ProName}}">

                            <input type="hidden" id="orgId" value="{{.product.OrgId}}"/><!--机构id隐藏域-->
                            <input type="hidden" id="busId" value="{{.product.BusId}}"/><!--商务联系人id隐藏域-->
                            <input type="hidden" id="loanProductType" value="1"/><!--0:小额贷款1：大额贷款-->
                            <input type="hidden" id="cooperationType" value="1"/> <!--h5合作-->

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="proLogo" class="col-sm-2 control-label">产品logo</label>
                        <div class="col-sm-4">
                            <img id="imgDisplay" alt="proLogo" src="{{.product.ProductLogo}}" width="189" height="189" />
                            <div style="height: 10px;"></div>
                            <form id="imgInput" enctype="multipart/form-data">
                                <input type="file" class="imgSelect" id="imgSelect" name="proIcon"/>
                            </form>
                            <input type="hidden" id="imgUrl" value="{{.product.ProductLogo}}"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">贷款信息</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="left" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="proApplicable" class="col-sm-3 control-label">产品期数<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="text" class="form-control" id="proApplicable" placeholder="以英文逗号隔开，例如1,3,5" value="{{.product.LoanTermCount}}">
                            </div>
                            <div class="col-sm-2" style="padding: 0;">
                                <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">月</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="minLimit" class="col-sm-3 control-label">最小额度<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="number" class="form-control" id="minLimit" placeholder="请输入最小额度" value="{{.product.MinMoney}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">元</span>
                        </div>
                        <div class="form-group">
                            <label for="minDeadline" class="col-sm-3 control-label">最小贷款期限<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="number" class="form-control" id="minDeadline" placeholder="请输入最小贷款期限" value="{{.product.MinLoanTerm}}">
                            </div>
                            <div class="col-sm-2" style="padding: 0;">
                                <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">月</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="rate" class="col-sm-3 control-label">大额月利率</label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="number" class="form-control" id="rate" placeholder="请输入大额月利率" value="{{.product.ReferenceRate}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">%</span>
                        </div>
                    </div>

                    <div style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="LendingRate" class="col-sm-3 control-label">放款速度<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" id="LendingRate" placeholder="请输入放款速度" value="{{.product.LoanSpeed}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="maxLimit" class="col-sm-3 control-label">最大额度<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4">
                                <input type="number" class="form-control" id="maxLimit" placeholder="请输入最大额度" value="{{printf "%.0f" .product.MaxMoney}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">元</span>
                        </div>
                        <div class="form-group">
                            <label for="maxDeadline" class="col-sm-3 control-label">最大贷款期限<b style="color:red; vertical-align: -3px;">*</b></label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="number" class="form-control" id="maxDeadline" placeholder="请输入最大贷款期限" value="{{.product.MaxLoanTerm}}">
                            </div>
                            <div class="col-sm-2" style="padding: 0;">
                                <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">月</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="service" class="col-sm-3 control-label">服务费</label>
                            <div class="col-sm-4" style="padding-left: : 10px;">
                                <input type="number" class="form-control" id="service" placeholder="服务费是一个按月的百分比" value="{{.product.LargeLoanFee}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="oneTime_service" class="col-sm-2 control-label">一次性服务费</label>
                        <div class="col-sm-4" style="padding-left: : 10px;">
                            <input type="number" class="form-control" id="oneTime_service" placeholder="请输入每笔贷款收取的百分比" value="{{.product.NonrecurringExpense}}">
                        </div>
                        <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">%</span>
                    </div>

                    <div class="form-group">
                        <label for="rateDetails" class="col-sm-2 control-label">利率详情<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <textarea id="rateDetails" class="form-control" style="height: 100px; max-height: 100px;" placeholder="利率详情模板：按月计费，月利率0.78%~3.99%，首次放款时扣除一次性服务费15元。举例：代扣5000元，期限为6个月，每月还款金额为872~1003元。">{{.product.InterestRatesDetails}}</textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="application_requirements" class="col-sm-2 control-label">申请条件<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <textarea id="application_requirements" class="form-control" style="height: 100px; max-height: 100px;" placeholder="请输入申请条件！">{{.product.RequestCondition}}</textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="required_material" class="col-sm-2 control-label">所需材料<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <textarea id="required_material" class="form-control" style="height: 100px; max-height: 100px;" placeholder="请输入所需材料！">{{.product.RequestedMaterial}}</textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-info proDtlSave" id="proDtlSave" style="margin: 0 auto; display: block; width: 120px;">保存</button>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane" id="tab3">
        <form class="form-horizontal">
            <div class="panel"  style="margin-bottom: 0px;">
                <input type="hidden" id="cleaningId" value="{{.cleaning.Id}}"/> <!--产品id-->
                <input type="hidden" id="proId" value="{{.cleaning.ProductId}}"/> <!--产品id-->
                <div class="panel-heading">合作方式</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="cooperateModel" class="col-sm-3 control-label">合作模式</label>
                            <div class="col-sm-4">
                                <select id="cooperateModel" class="form-control">
                                    <option {{if eq .cleaning.JointMode 1}}selected="selected"{{end}} >CPA</option>
                                    <option {{if eq .cleaning.JointMode 2}}selected="selected"{{end}} >CPS</option>
                                    <option {{if eq .cleaning.JointMode 3}}selected="selected"{{end}} >CPA+CPS</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ASelect" class="col-sm-3 control-label">A有效性定义</label>
                            <div class="col-sm-4">
                                <select id="ASelect" class="form-control">
                                    <option value="1">注册</option>
                                    <option value="2">认证</option>
                                    <option value="3">授信</option>
                                    <option value="4">申请借款</option>
                                    <option value="5">放款</option>
                                </select>
                            </div>
                            <script>
                                $("#ASelect option:contains({{.cleaning.CpaDefine}})").attr('selected','selected');
                            </script>
                        </div>
                        <div class="form-group">
                            <label for="first_lend" class="col-sm-3 control-label">S的首借百分比</label>
                            <div class="col-sm-4">
                                <input type="number" id="first_lend" class="form-control" placeholder="请输入S的首借百分比" value="{{.cleaning.CpsFirstPer}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">%</span>
                        </div>
                        <div class="form-group">
                            <label for="settlementInterval" class="col-sm-3 control-label">结算周期</label>
                            <div class="col-sm-8">
                                <textarea id="settlementInterval" class="form-control" style="height: 100px; max-height: 100px;" placeholder="结算周期为周结、半月结、月结。也可自定义输入详细信息，例如：每月10号前结算">{{.cleaning.CleaningCycle}}</textarea>
                            </div>
                        </div>
                    </div>

                    <div style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="settleWays" class="col-sm-3 control-label">结算方式</label>
                            <div class="col-sm-4">
                                <select id="settleWays" class="form-control">
                                    <option {{if eq .cleaning.CleaningType 1}}selected="selected"{{end}} >对公</option>
                                    <option {{if eq .cleaning.CleaningType 2}}selected="selected"{{end}} >对私</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="APrice" class="col-sm-3 control-label">A的价格</label>
                            <div class="col-sm-4" style="padding-left: 10px;">
                                <input type="number" id="APrice" class="form-control" placeholder="请输入A的价格" value="{{.cleaning.CpaPrice}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">元</span>
                        </div>
                        <div class="form-group">
                            <label for="after_lend" class="col-sm-3 control-label">S的复借百分比</label>
                            <div class="col-sm-4">
                                <input type="number" id="after_lend" class="form-control" placeholder="请输入S的复借百分比" value="{{.cleaning.CpsAgainPer}}">
                            </div>
                            <span class="col-sm-2" style="padding: 8px 0 0 0; color: #65CEA7;">%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel" style="margin-bottom: 0px;">
                <div class="panel-heading">开票信息</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="companyName" class="col-sm-2 control-label">公司名称</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="companyName" placeholder="请输公司名称" value="{{.cleaning.CompanyName}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="companyAddr" class="col-sm-2 control-label">公司地址</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="companyAddr" placeholder="请输公司地址" value="{{.cleaning.CompanyAddress}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dutyParagraph" class="col-sm-2 control-label">税号</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="dutyParagraph" placeholder="请输税号" value="{{.cleaning.TaxNumber}}">
                        </div>
                    </div>
                    <div class="left" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="openingBank" class="col-sm-3 control-label">开户行</label>
                            <div class="col-sm-6">
                                <input type="text" id="openingBank" class="form-control" placeholder="请输入开户行" value="{{.cleaning.BankAccount}}">
                            </div>
                        </div>
                    </div>
                    <div class="right" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="bankAccount" class="col-sm-3 control-label">银行账号</label>
                            <div class="col-sm-6">
                                <input type="number" id="bankAccount" class="form-control" placeholder="请输入银行账号" value="{{.cleaning.AccountBank}}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">后台信息</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="left" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="companyWebsiteAddr" class="col-sm-3 control-label">公司网址</label>
                            <div class="col-sm-6">
                                <input type="text" id="companyWebsiteAddr" class="form-control" placeholder="请输入公司网址" value="{{.cleaning.BackUrl}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="bgAccount" class="col-sm-3 control-label">后台账号</label>
                            <div class="col-sm-6">
                                <input type="text" id="bgAccount" class="form-control" placeholder="请输入后台账号" value="{{.cleaning.BackAccount}}">
                            </div>
                        </div>
                    </div>
                    <div class="right" style="width: 50%; float: left;">
                        <div class="form-group">
                            <label for="channelNo" class="col-sm-3 control-label">渠道号</label>
                            <div class="col-sm-6">
                                <input type="number" id="channelNo" class="form-control" placeholder="请输入渠道号" value="{{.cleaning.FromNum}}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="bgPassword" class="col-sm-3 control-label">后台密码</label>
                            <div class="col-sm-6">
                                <input type="text" id="bgPassword" class="form-control" placeholder="请输入后台密码" value="{{.cleaning.BackPwd}}">
                            </div>
                        </div>
                    </div>
                    <!--创建时间-->
                    <input type="hidden" id="cleaningCreateTime" value="{{.cleaning.CreateTime}}"/>

                    <div style="clear: both;"></div>
                    <button type="button" class="btn btn-info settleDtlSave" id="settleDtlSave" style="margin: 0 auto; display: block; width: 120px;">保存</button>
                </div>
            </div>
        </form>
    </div>

    <div class="tab-pane" id="tab4">
        <form class="form-horizontal">
            <div class="panel" style="margin-bottom: 0px;">
                <div class="panel-heading">主要链接</div>
                <!--MainUrlid-->
                <input type="hidden" id="UrlId" value="{{.mainUrl.UrlId}}"/>
                <input type="hidden" id="BeforeId" value="{{.mainUrl.BeforeId}}"/>
                <input type="hidden" id="AfterId" value="{{.mainUrl.AfterId}}"/>

                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="url1" class="col-sm-2 control-label">我司链接<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="url1" placeholder="请输入我司链接" value="{{.mainUrl.Url}}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel" style="margin-bottom: 0px;">
                <div class="panel-heading">注册事件链接</div>
                <div class="panel-body" style="padding: 30px 0;">
                    <div class="form-group">
                        <label for="regste_url_before" class="col-sm-2 control-label">注册前链接<b style="color:red; vertical-align: -3px;">*</b></label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="regste_url_before" placeholder="请输公司名称" value="{{.mainUrl.RegsteUrlBefore}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="regste_url_after" class="col-sm-2 control-label">注册后链接</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="regste_url_after" placeholder="请输公司地址" value="{{.mainUrl.RegsteUrlAfter}}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">代理链接</div>
                <div class="panel-body" style="padding: 30px 0;">
                <input type="hidden" id="agentUrlCount" value="{{.agentUrlCount}}"/>
                    <div class="urlArr">
                    {{range $k, $agentUrl := .agentUrlList}}
                        <div class="form-group">
                            <label class="col-sm-2 control-label">代理链接{{$k | addOne}}</label>
                            <input type="hidden" id="agentUrl{{$k | addOne}}" class="agentIdInput" value="{{$agentUrl.Id}}"/>
                            <div class="col-sm-4">
                                <input type="text" class="form-control agentInput" value="{{$agentUrl.Url}}" id="{{$k | addOne}}">
                            </div>
                            {{if eq $agentUrl.HasOwn 1}}<a>未使用</a>{{end}}
                            {{if eq $agentUrl.HasOwn 2}}<a>已使用</a>{{end}}
                        </div>
                    {{end}}
                    </div>
                    <img src="../../static/img/addUrl.png" class="newAddUrl" id="newAddUrl" style="margin-left: 15%; cursor: pointer;" />
                    <button type="button" class="btn btn-info urlManagementDtlSave" id="urlManagementDtlSave" style="margin: 0 auto; display: block; width: 120px;">保存</button>
                </div>
            </div>
        </form>
    </div>
</div>








<script>

    //机构信息保存按钮事件
    $('#jigouDtlSave').off('click').on('click', function(){
        var orgId = $('#orgId').val();   //机构信息ID
        var busId = $('#busId').val();   //商务联系人ID
        var jigouName = $.trim($("#jigouName").val());  //机构名称
        var contactAddr = $.trim($("#contactAddr").val());  //通讯录地址
        var contactMail = $.trim($("#contactMail").val());  //联系邮箱
        var contactName = $.trim($("#contactName").val());  //联系人姓名
        var contactPhone = $.trim($("#contactPhone").val());  //手机号码
        var weixinCode = $.trim($("#weixinCode").val());  //微信
        var QQCode = $.trim($("#QQCode").val());  //QQ
        var eMail = $.trim($("#eMail").val());  //邮箱

        if (!jigouName){
            alert("请输入机构名称！");
            return;
        }

        //验证邮箱
        if(contactMail && !/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/.test(contactMail)){
            alert('邮箱格式不正确！');
            return;
        }
        if(eMail && !/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/.test(eMail)){
            alert('邮箱格式不正确！');
            return;
        }

        //验证手机号码
        if(contactPhone && !/^1\d{10}$/.test(contactPhone)){
            alert('手机号码格式不正确！');
            return;
        }

        $.zpost("/organization/update", {
                OrgId: orgId,
                BusId: busId,
                OrgName: jigouName,
                Address: contactAddr,
                OrgEmail: contactMail,
                BusName: contactName,
                Phone: contactPhone,
                Wechat: weixinCode,
                Qq: QQCode,
                BusEmail: eMail
            },
            function (result) {
                if (result.ret == 200) {
                    alert("保存成功！");
                } else {
                    alert(result.err)
                }
            }
        );
    });



    //图片上传
    $("#imgSelect").on("change", function () {
        var formData = new FormData($("#imgInput")[0]);
        var file = $('#imgSelect').val();
        if(!/\.(gif|jpg|jpeg|png|gif|jpg|png)$/i.test(file)){
            alert("图片类型必须是.gif,jpeg,jpg,png中的一种");
            return false;
        }
        $.ajax({
            url: '/product/uploadIcon',
            type: 'POST',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.ret = 200) {
                    $("#imgDisplay").attr("src", data.url)
                    $("#imgUrl").val(data.url)
                } else {
                    alert("上传失败！")
                }
            }
        });
    });


    //产品信息保存按钮事件
    $("#proDtlSave").off('click').on('click', function(){
        var productId = $('#productId').val();
        var loanProductType = $('#loanProductType').val();
        var cooperationType = $('#cooperationType').val();   //h5合作
        var orgId = $('#orgId').val();   //机构id
        var busId = $('#busId').val();   //商务联系人id
        var proName = $.trim($('#proName').val());   //产品名称
        var imgUrl = $('#imgUrl').val();    //产品logo
        var proApplicable = $.trim($('#proApplicable').val());  //产品期数
        var LendingRate = $.trim($('#LendingRate').val());   //放款速度
        var minLimit = $.trim($('#minLimit').val());   //最小额度
        var maxLimit = $.trim($('#maxLimit').val());   //最大额度
        var minDeadline = $.trim($('#minDeadline').val());  //最小贷款期限
        var maxDeadline = $.trim($('#maxDeadline').val());  //最大贷款期限
       

        var rate = $.trim($('#rate').val());  //大额月利率
        var service = $.trim($('#service').val());  //服务费
        var oneTime_service = $.trim($('#oneTime_service').val());  //一次性服务费

        var rateDetails = $.trim($('#rateDetails').val());  //利率详情
        var application_requirements = $.trim($('#application_requirements').val());  //申请条件
        var required_material = $.trim($('#required_material').val());  //所需材料

        if(!proName){
            alert('请输入产品名称！');
            return;
        }
        if(!imgUrl){
            alert('请上传图片！');
            return;
        }

        if(!proApplicable){
            alert("请输入产品期数！");
            return;
        }

        if(proApplicable && proApplicable.indexOf('，') > -1){
            alert("产品期数请用英文逗号隔开！");
            return;
        }

        if(!LendingRate){
            alert("请输入放款速度！");
            return;
        }

        if(!minLimit){
            alert("请输入最小额度！");
            return;
        }

        if(minLimit && minLimit <= 0){
            alert("最小额度必须大于0！");
            return;
        }

        if(!maxLimit){
            alert("请输入最大额度！");
            return;
        }

        if(maxLimit && maxLimit <= 0){
            alert("最大额度必须大于0！");
            return;
        }

        if(!minDeadline){
            alert("请输入最小贷款期限！");
            return;
        }

        if(minDeadline && !/^[0-9]*[1-9][0-9]*$/.test(minDeadline)){
            alert("最小贷款期限必须为正整数！");
            return;
        }

        if(!maxDeadline){
            alert("请输入最大贷款期限！");
            return;
        }

        if(maxDeadline && !/^[0-9]*[1-9][0-9]*$/.test(maxDeadline)){
            alert("最大贷款期限必须为正整数！");
            return;
        }

        if(!rateDetails){
            alert('请输入利率详情！')
            return;
        }
        if(!application_requirements){
            alert('请输入申请条件！')
            return;
        }
        if(!required_material){
            alert('请输入所需材料！')
            return;
        }
        

        $.zpost("/product/update", {
                Id: productId,
                OrgId: orgId,
                BusId: busId,
                ProName: proName,
                ProductLogo: imgUrl,
                LoanTermCount: proApplicable,
                LoanSpeed: LendingRate,
                MinMoney: minLimit,
                MaxMoney: maxLimit,
                MinLoanTerm: minDeadline,
                MaxLoanTerm: maxDeadline,
                LoanTermUnit: 1,
                LoanTaxFee: rate,
                ReferenceRate: rate,
                LargeLoanFee: service,
                NonrecurringExpense: oneTime_service,
                InterestRatesDetails: rateDetails,
                RequestCondition: application_requirements,
                RequestedMaterial: required_material,
                CooperationType: cooperationType,
                LoanProductType: loanProductType,
            },
            function(result){
                if(result.ret == 200) {
                   alert("保存成功!");
                }else{
                    alert(result.err)
                }
            }
        );
    });


    //结算信息保存按钮事件
    $('#settleDtlSave').off('click').on('click', function(){
        var cleaningId = $('#cleaningId').val();
        var proId = $("#proId").val();   //产品id
        var cooperateModel = $("#cooperateModel option:checked").index() + 1;    //合作模式
        var settleWays = $("#settleWays option:checked").index() + 1;    //结算方式
        var ASelect = $('#ASelect').val();   //A的有效性定义
        var APrice = $.trim($('#APrice').val());    //A的价格
        var first_lend = $.trim($('#first_lend').val());   //S的首借百分比
        var after_lend = $.trim($('#after_lend').val());   //S的复借百分比
        var settlementInterval = $.trim($('#settlementInterval').val());   //结算周期
        var companyName = $.trim($('#companyName').val());   //公司名称
        var companyAddr = $.trim($('#companyAddr').val());   //公司地址
        var dutyParagraph = $.trim($('#dutyParagraph').val());   //税号
        var openingBank = $.trim($('#openingBank').val());   //开户行
        var bankAccount = $.trim($('#bankAccount').val());   //银行账号
        var companyWebsiteAddr = $.trim($('#companyWebsiteAddr').val());   //公司网址
        var channelNo = $.trim($('#channelNo').val());   //渠道号
        var bgAccount = $.trim($('#bgAccount').val());   //后台账号
        var bgPassword = $.trim($('#bgPassword').val());   //后台密码

        $.zpost("/cleaning/updateH5", {
                Id: cleaningId,
                ProductId: proId,
                JointMode: cooperateModel,
                CleaningType: settleWays,
                CpaDefine: ASelect,
                CpaPrice: APrice,
                CpsFirstPer: first_lend,
                CpsAgainPer: after_lend,
                CleaningCycle: settlementInterval,
                CompanyName: companyName,
                CompanyAddress: companyAddr,
                TaxNumber: dutyParagraph,
                BankAccount: openingBank,
                AccountBank: bankAccount,
                BackUrl: companyWebsiteAddr,
                BackAccount: bgAccount,
                BackPwd: bgPassword,
                FromNum: channelNo
            },
            function (result) {
                if (result.ret == 200) {
                    alert("保存成功！");
                } else {
                    alert(result.err);

                }
            }
        );
    });


    //链接信息保存按钮事件
    $("#urlManagementDtlSave").off('click').on('click', function(){
        var mainUrlId = $('#mainUrlId').val();
        var productId = $('#productId').val();
        var BeforeId = $('#BeforeId').val();
        var AfterId = $('#AfterId').val();
        var UrlId = $('#UrlId').val();

        var url1 = $.trim($('#url1').val());   //我司链接
        var regste_url_before = $.trim($('#regste_url_before').val());   //注册前链接
        var regste_url_after = $.trim($('#regste_url_after').val());   //注册后链接

        if(!url1){
            alert('请输入我司链接！');
            return;
        }

        if(!regste_url_before){
            alert('请输入注册前链接！');
            return;
        }

        //将代理链接拼接
        var agentInputArr = [];
        var agentInputArr_str = '';
        $.each($('.agentInput'), function(index, value){
            agentInputArr.push($.trim($(this).val()));
        });
        agentInputArr_str = agentInputArr.join(',');

        //将代理链接ID拼接
        var agentIdArray = [];
        var agentIdArray_str = '';
        $.each($('.agentIdInput'), function(index, value){
            agentIdArray.push($.trim($(this).val()));
        });
        agentIdArray_str = agentIdArray.join(',');

        $.zpost("/url/update", {
                Id: mainUrlId,
                ProductId: productId,
                BeforeId: BeforeId,
                AfterId: AfterId,
                UrlId: UrlId,
                Url: url1,
                RegsteUrlBefore: regste_url_before,
                RegsteUrlAfter: regste_url_after,
                agentUrl: agentInputArr_str,
                agentUrlId: agentIdArray_str
            },
            function (result) {
                if (result.ret == 200) {
                    alert("保存成功！");
                    getpage(window.sessionStorage.URl);
                } else {
                    alert(result.err + '：' + result.msg);
                }
            }
        );
    });

    //点击添加代理链接
    var count = $("#agentUrlCount").val();;
    $('#newAddUrl').off('click').on('click', function(){
        var urlHtml =   '<div class="form-group">'+
                            '<label class="col-sm-2 control-label">代理链接' + count + '</label>'+
                            '<div class="col-sm-4">'+
                                '<input type="text" class="form-control agentInput">'+
                            '<div>'+
                        '<div>';
        count ++;
        $('.urlArr').append(urlHtml);
    });


</script>

































































































